<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>4. テーブル &#8212; Macchinetta Client (1.x) Development Guideline 1.2.0.RELEASE documentation</title>
    <link rel="stylesheet" href="../_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.0.RELEASE',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. 操作性向上・制御" href="../manipulation/index.html" />
    <link rel="prev" title="3. UIコンポーネント" href="../uicomponent/index.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<link href="../_static/solarized-dark.css" rel="stylesheet">
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../manipulation/index.html" title="5. 操作性向上・制御"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="../uicomponent/index.html" title="3. UIコンポーネント"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Macchinetta Client (1.x) Development Guideline 1.2.0.RELEASE documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">4. テーブル</a><ul>
<li><a class="reference internal" href="#grid-basic-usages">4.1. ライブラリの基本的な使用方法</a><ul>
<li><a class="reference internal" href="#basic-usages-slickgrid">4.1.1. SlickGrid基本構成サンプル</a></li>
<li><a class="reference internal" href="#basic-usages-tablesorter">4.1.2. tablesorter基本構成サンプル</a></li>
</ul>
</li>
<li><a class="reference internal" href="#insert-and-delete-row">4.2. 行追加・削除・編集</a><ul>
<li><a class="reference internal" href="#insert-and-delete-row-overview">4.2.1. 概要</a></li>
<li><a class="reference internal" href="#insert-and-delete-row-howtouse">4.2.2. 利用方法</a><ul>
<li><a class="reference internal" href="#id15">4.2.2.1. SlickGridによる行追加・削除・編集サンプル</a></li>
<li><a class="reference internal" href="#id17">4.2.2.2. tablesorterによる行追加・削除・編集サンプル</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#move-row">4.3. 行の並び替え</a><ul>
<li><a class="reference internal" href="#move-row-outline">4.3.1. 概要</a></li>
<li><a class="reference internal" href="#move-row-howtouse">4.3.2. 利用方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fixed-header">4.4. ヘッダを固定したデータ行のスクロール</a><ul>
<li><a class="reference internal" href="#fixed-header-outline">4.4.1. 概要</a></li>
<li><a class="reference internal" href="#fixed-header-howtouse">4.4.2. 利用方法</a><ul>
<li><a class="reference internal" href="#id29">4.4.2.1. SlickGridによるヘッダを固定したデータ行のスクロール</a></li>
<li><a class="reference internal" href="#id30">4.4.2.2. tablesorterによるヘッダを固定したデータ行のスクロール</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#pagination">4.5. ページネーション</a><ul>
<li><a class="reference internal" href="#pagination-outline">4.5.1. 概要</a></li>
<li><a class="reference internal" href="#pagination-howtouse">4.5.2. 利用方法</a><ul>
<li><a class="reference internal" href="#id38">4.5.2.1. SlickGridによるページネーション</a></li>
<li><a class="reference internal" href="#id40">4.5.2.2. TableSorterを用いた表示データのページネーション</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#sort">4.6. ソート</a><ul>
<li><a class="reference internal" href="#sort-outline">4.6.1. 概要</a></li>
<li><a class="reference internal" href="#sort-howtouse">4.6.2. 利用方法</a><ul>
<li><a class="reference internal" href="#id48">4.6.2.1. SlickGridによるソート</a></li>
<li><a class="reference internal" href="#id49">4.6.2.2. tablesorterによるソート</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#swap-columns">4.7. カラムの並び替え</a></li>
<li><a class="reference internal" href="#copy-and-paste">4.8. コピーアンドペースト編集</a><ul>
<li><a class="reference internal" href="#copy-and-paste-outline">4.8.1. 概要</a></li>
<li><a class="reference internal" href="#copy-and-paste-howtouse">4.8.2. 利用方法</a></li>
</ul>
</li>
<li><a class="reference internal" href="#slickgrid-with-ajax">4.9. テーブルのスクロールによる非同期データ取得</a><ul>
<li><a class="reference internal" href="#slickgrid-with-ajax-overview">4.9.1. 概要</a></li>
<li><a class="reference internal" href="#slickgrid-with-ajax-howtouse">4.9.2. 利用方法</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../uicomponent/index.html"
                        title="previous chapter">3. UIコンポーネント</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../manipulation/index.html"
                        title="next chapter">5. 操作性向上・制御</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="table-index">
<span id="id1"></span><h1>4. テーブル<a class="headerlink" href="#table-index" title="Permalink to this headline">¶</a></h1>
<p>この章では、テーブルのライブラリであるSlickGrid、tablesorterを用いた実装例を説明する。</p>
<p>それぞれのライブラリが実現できる機能は、次の表の通りである。</p>
<table border="1" class="colwidths-given docutils" id="id61">
<caption><span class="caption-text">ライブラリが実現できる機能</span><a class="headerlink" href="#id61" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="30%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">機能</th>
<th class="head">SlikGrid</th>
<th class="head">tablesorter</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>行追加・削除・編集</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-green">✔</span></td>
</tr>
<tr class="row-odd"><td>行の並び替え</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-red">✗</span></td>
</tr>
<tr class="row-even"><td>ヘッダを固定したデータ行のスクロール</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-green">✔</span></td>
</tr>
<tr class="row-odd"><td>ページネーション</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-green">✔</span></td>
</tr>
<tr class="row-even"><td>ソート</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-green">✔</span></td>
</tr>
<tr class="row-odd"><td>カラムの並び替え</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-red">✗</span></td>
</tr>
<tr class="row-even"><td>コピーアンドペースト編集</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-red">✗</span></td>
</tr>
<tr class="row-odd"><td>テーブルのスクロールによる非同期データ取得</td>
<td><span class="text-green">✔</span></td>
<td><span class="text-red">✗</span></td>
</tr>
</tbody>
</table>
<p>どちらのライブラリを使用するかは、上に示した機能や、特徴 (<a class="reference internal" href="../libraries-overview.html#libraries-overview-slickgrid"><span class="std std-ref">SlickGrid概要</span></a>および<a class="reference internal" href="../libraries-overview.html#libraries-overview-tablesorter"><span class="std std-ref">tablesorter概要</span></a>) を参考にして判断すること。</p>
<p>また、SlickGridとBootstrapを同時に使用する場合、<a class="reference internal" href="../appendix.html#grid-notice"><span class="std std-ref">付録の注意点</span></a>を考慮すること。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">SlickGridはテーブルのセル数に応じてDOMが変化する。また、スクロールを行い表示内容が変化するタイミングでDOMの書き換えが発生する。
テーブルのセル数が多い場合、スクロール操作の度に多数のDOMを書き換える必要があり、大きなオーバーヘッドが発生することがあるため、十分に検証を行った上で採用すること。</p>
</div>
<div class="section" id="grid-basic-usages">
<span id="id2"></span><h2>4.1. ライブラリの基本的な使用方法<a class="headerlink" href="#grid-basic-usages" title="Permalink to this headline">¶</a></h2>
<p>ここでは、テーブルを扱うライブラリであるSlickGridとtablesorterの基本的な使用方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/default.html">SlickGrid基本構成サンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
<tr class="row-odd"><td>tablesorter</td>
<td><a class="reference external" href="../samples/tablesorter/default.html">tablesorter基本構成サンプル</a></td>
<td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/">jQuery plugin: Tablesorter 2.0</a></td>
</tr>
</tbody>
</table>
<div class="section" id="basic-usages-slickgrid">
<span id="id3"></span><h3>4.1.1. SlickGrid基本構成サンプル<a class="headerlink" href="#basic-usages-slickgrid" title="Permalink to this headline">¶</a></h3>
<p>HTMLでは、SlickGrid用のスタイルシート、依存ライブラリ、SlickGridモジュール、さらにSlickGridでテーブルを生成するために実装したJavaScriptファイル(js/default.js)を読み込む。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="c">&lt;!-- Copyright(c) 2018 NTT Corporation. --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>SlickGrid基本構成サンプル<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- SlickGrid用のスタイルシートの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;../lib/vendor/slickgrid/2.3.19/slick.grid.css&quot;</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;css/main.css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>SlickGrid基本構成サンプル<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- SlickGridテーブルの表示領域となる要素 --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;myGrid&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;grid&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;grid&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- 依存ライブラリの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery/3.3.1/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.event.drag-drop/2.3.0/jquery.event.drag.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery-ui/1.12.1/jquery-ui.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- SlickGridモジュールの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/slickgrid/2.3.19/slick.core.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/slickgrid/2.3.19/slick.grid.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- 実装したJavaScriptファイルの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;js/default.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>JavaScript(js/default.js)では、<code class="docutils literal"><span class="pre">Slick.Grid</span></code>コンストラクタを実行することで、指定した領域にテーブルを生成する。
<code class="docutils literal"><span class="pre">Slick.Grid</span></code>コンストラクタのシグネチャは次のとおり。</p>
<dl class="function">
<dt>
<code class="descclassname">Slick.</code><code class="descname">Grid</code><span class="sig-paren">(</span><em>container</em>, <em>data</em>, <em>columns</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>container</strong> (<em>String</em>) – テーブルの表示領域となる要素のセレクタ</li>
<li><strong>data</strong> (<em>Array|DataView|Object</em>) – テーブルで扱うデータ配列。データの表示条件をより詳細に制御する場合は、配列の代わりに、<code class="docutils literal"><span class="pre">DataView</span></code>オブジェクトや、<code class="docutils literal"><span class="pre">getLength</span></code>と<code class="docutils literal"><span class="pre">getItem</span></code>関数を持つオブジェクトを指定することもできる。</li>
<li><strong>columns</strong> (<em>Array</em>) – カラム定義。各カラムごとに表示名やデータ項目などのプロパティをもつオブジェクトを配列で複数指定する。</li>
<li><strong>options</strong> (<em>Object</em>) – 動作オプション</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// default.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// (1) SlickGridのカラム定義</span>
  <span class="c1">//     6つのカラムのそれぞれにつき ID・表示名・マッピングするデータ を定義している。</span>
  <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;% Complete&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;percentComplete&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Finish&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;effort-driven&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Effort Driven&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;effortDriven&#39;</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// (2) SlickGridの動作オプション</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// 何も指定しない。</span>
  <span class="p">};</span>

  <span class="c1">// (3) 1000件のサンプルデータ作成</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// データのプロパティ名を columns で定義した field 値と一致させることで、</span>
    <span class="c1">// 表示データがマッピングされる。</span>
    <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;タスク &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">duration</span><span class="o">:</span> <span class="s1">&#39;5 days&#39;</span><span class="p">,</span>
      <span class="nx">percentComplete</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
      <span class="nx">start</span><span class="o">:</span> <span class="s1">&#39;01/01/2009&#39;</span><span class="p">,</span>
      <span class="nx">finish</span><span class="o">:</span> <span class="s1">&#39;01/05/2009&#39;</span><span class="p">,</span>
      <span class="nx">effortDriven</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 画面初期化処理</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// (4) SlickGridテーブルを作成</span>
    <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>カラム定義は、ソースコードリスト上の(1)で行っている。この例では6列のカラムを定義し、それぞれIDやヘッダの表示テキスト(<code class="docutils literal"><span class="pre">name</span></code>)、表示データ名(<code class="docutils literal"><span class="pre">field</span></code>)を指定している。</p>
<p>オプションの設定は(2)で行う。この例は基本構成なのでオプションは指定しないが、以降のサンプルではここに設定を追加していく。</p>
<p>データの作成は(3)で行っている。この例では1000件のデータを作成している。各データの<code class="docutils literal"><span class="pre">title</span></code>などのデータは、カラム定義の<code class="docutils literal"><span class="pre">field</span></code>プロパティと一致するカラムに表示される。意図した通りにデータが表示されない場合は、カラム定義とデータのプロパティ名が一致していない可能性があるため、見直すこと。</p>
<p>最後に(4)で、これらの設定値やデータを用いて <code class="docutils literal"><span class="pre">Slick.Grid</span></code> コンストラクタを実行しテーブルを作成している。</p>
<div class="admonition note" id="slickgrid-required-resources">
<p class="first admonition-title">Note</p>
<p>SlickGridには様々な依存ライブラリやスタイルシート、機能拡張用モジュールがあり、使用する機能に応じてこれらを読み込む必要がある。以下に、それぞれのファイルがどのような際に必要とされるかをまとめている(用途の少ないものは省略している)。</p>
<blockquote class="last">
<div><table border="1" class="colwidths-given docutils" id="id62">
<caption><span class="caption-text">依存ライブラリ</span><a class="headerlink" href="#id62" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">依存ライブラリ名</th>
<th class="head">必要なケース</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>jQuery</td>
<td>常に必要</td>
</tr>
<tr class="row-odd"><td>jQuery UI Sortable</td>
<td>常に必要<a class="footnote-reference" href="#slickgrid-requires-jquery-ui" id="id4">[1]</a></td>
</tr>
<tr class="row-even"><td>jquery.event.drag</td>
<td>常に必要</td>
</tr>
<tr class="row-odd"><td>jquery.event.drop</td>
<td>常に必要<a class="footnote-reference" href="#slickgrid-not-requires-jqdrop" id="id5">[2]</a></td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id63">
<caption><span class="caption-text">SlickGrid用スタイルシート</span><a class="headerlink" href="#id63" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ファイル名</th>
<th class="head">必要なケース</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slick.grid.css</td>
<td>常に必要</td>
</tr>
<tr class="row-odd"><td>css/smoothness/jquery-ui-1.8.16.custom.css</td>
<td>jQuery UIのスタイルを適用する場合、またはページネーション機能を要する場合</td>
</tr>
<tr class="row-even"><td>controls/slick.pager.css</td>
<td>ページネーション機能を要する場合</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id64">
<caption><span class="caption-text">SlickGridモジュール</span><a class="headerlink" href="#id64" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ファイル名</th>
<th class="head">必要なケース</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slick.core.js</td>
<td>常に必要</td>
</tr>
<tr class="row-odd"><td>slick.grid.js</td>
<td>常に必要</td>
</tr>
<tr class="row-even"><td>slick.editors.js</td>
<td>データの編集機能を要する場合</td>
</tr>
<tr class="row-odd"><td>slick.dataview.js</td>
<td>データの表示条件を詳細に制御する必要のある場合<a class="footnote-reference" href="#slickgrid-dataview" id="id6">[3]</a></td>
</tr>
<tr class="row-even"><td>plugins/slick.cellrangeselector.js</td>
<td>セル選択機能を要する場合(ドラッグアンドドロップでの選択操作を可能にする)</td>
</tr>
<tr class="row-odd"><td>plugins/slick.cellrangedecorator.js</td>
<td>セル選択機能を要する場合(選択範囲を可視化する)</td>
</tr>
<tr class="row-even"><td>plugins/slick.cellselectionmodel.js</td>
<td>セル選択機能を要する場合(データ選択範囲をプログラムから変更可能にする)</td>
</tr>
<tr class="row-odd"><td>plugins/slick.cellcopymanager.js</td>
<td>コピーアンドペースト機能を要する場合</td>
</tr>
<tr class="row-even"><td>plugins/slick.rowselectionmodel.js</td>
<td>行選択機能を要する場合</td>
</tr>
<tr class="row-odd"><td>plugins/slick.rowmovemanager.js</td>
<td>行の並び替え機能を要する場合</td>
</tr>
<tr class="row-even"><td>controls/slick.pager.js</td>
<td>ページネーション機能を要する場合</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<table class="docutils footnote" frame="void" id="slickgrid-requires-jquery-ui" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[1]</a></td><td>公式ドキュメントではソート機能を有効化した場合のみ必要と記載されているが、他にカーソル操作での選択セル移動機能や、セルのコピーアンドペースト機能などにも使用されている。そのため、基本的には常に読み込んでおくほうが無難ではあるが、ファイルサイズが比較的大きいため、極力読み込ませずに済ませたい場合には、動作確認を充分に行うこと。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="slickgrid-not-requires-jqdrop" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[2]</a></td><td>公式ドキュメントでは依存ライブラリとして記載されているが、実際のところは利用されていない。よって、テストで正常に動作することが確認できれば、読み込まなくてもよい。</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="slickgrid-dataview" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[3]</a></td><td>データ表示条件を詳細に制御できる部品<code class="docutils literal"><span class="pre">DataView</span></code>が利用可能になる。これによって、ページネーション、複数カラムでのソート、検索、グループ化などが可能になる。詳細は <a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">https://github.com/6pac/SlickGrid/wiki</a> を参照すること。</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>ウインドウの幅に併せてテーブルの幅を変更したい場合は、SlickGridの提供機能ではないが、次のように記述して対応できる。</p>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// (2) SlickGridの動作オプション</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

  <span class="c1">// テーブルの幅をコンテナの幅に合わせるオプションを指定</span>
  <span class="nx">forceFitColumns</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// 画面初期化処理</span>
<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// (4) SlickGridテーブルを作成</span>
  <span class="c1">// SlickGridのインスタンスをgrid変数に格納</span>
  <span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// ウィンドウサイズが変更された際に発生するイベントで、</span>
<span class="c1">// コンテナ幅にテーブルのサイズを合わせるメソッドを実行する処理を追加</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">grid</span><span class="p">.</span><span class="nx">resizeCanvas</span><span class="p">();</span>
<span class="p">});</span>
</pre></div>
</div>
</div></blockquote>
<p class="last">ただし、ウインドウサイズを変更するたびに処理が発生するため、動作がもたつくことがある。
頻繁にウインドウサイズの変更を求められる画面では注意すること。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">jquery.event.drag, jquery.event.drop については、<a class="reference external" href="http://threedubmedia.com/">公式サイト</a>  で提供されている最終リリースバージョンは 2.2 であるが、SlickGrid(6pac) の依存ライブラリバージョンとして非公認であるバージョン 2.3 の利用を推奨していることから、本ガイドラインのサンプルプログラムにおいてもバージョン 2.3 を使用する。詳細は <a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">https://github.com/6pac/SlickGrid/wiki</a> を参照すること。</p>
</div>
</div>
<div class="section" id="basic-usages-tablesorter">
<span id="id8"></span><h3>4.1.2. tablesorter基本構成サンプル<a class="headerlink" href="#basic-usages-tablesorter" title="Permalink to this headline">¶</a></h3>
<p>HTMLでは、tablesorter用のスタイルシート、依存ライブラリ、tablesorterモジュール、さらにtablesorterを有効にするために実装したJavaScriptファイル(js/default.js)を読み込む。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="c">&lt;!-- Copyright(c) 2018 NTT Corporation. --&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;utf-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>tablesorter基本構成サンプル<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- tablesorter用のスタイルシートの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.tablesorter/2.30.7/css/theme.default.css&quot;</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>tablesorter基本構成サンプル<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>

    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;table&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">th</span><span class="p">&gt;</span>姓<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>名<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>年齢<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>毛利<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>正雄<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>2<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>安田<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>さとみ<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>28<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>坂<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>文夫<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>45<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>小本<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>里香<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>18<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
          <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>中居<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>大輔<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;</span>22<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- 依存ライブラリの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery/3.3.1/jquery.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- tablesorterモジュールの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.tablesorter/2.30.7/js/jquery.tablesorter.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

    <span class="c">&lt;!-- 実装したJavaScriptファイルの読み込み --&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;js/default.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>JavaScript(js/default.js)では、table要素に対し、<code class="docutils literal"><span class="pre">tablesorter</span></code>メソッドを実行することで、指定したテーブルにtablesorterの動作を適用する。また、<code class="docutils literal"><span class="pre">tablesorter</span></code>メソッドのプロパティとしてオプションを指定することで、様々な動作を実現することができる。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// default.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.table&#39;</span><span class="p">).</span><span class="nx">tablesorter</span><span class="p">({</span>

    <span class="c1">// tablesorterの動作オプション</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note" id="tablesorter-required-resources">
<p class="first admonition-title">Note</p>
<p>tablesorterには様々な依存ライブラリやスタイルシート、機能拡張用モジュールがあり、使用する機能に応じてこれらを読み込む必要がある。以下に、それぞれのファイルがどのような際に必要とされるかをまとめている(用途の少ないものは省略している)。</p>
<blockquote class="last">
<div><table border="1" class="colwidths-given docutils" id="id65">
<caption><span class="caption-text">依存ライブラリ</span><a class="headerlink" href="#id65" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">依存ライブラリ名</th>
<th class="head">必要なケース</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>jQuery</td>
<td>常に必須</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id66">
<caption><span class="caption-text">tablesorter用スタイルシート</span><a class="headerlink" href="#id66" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ファイル名</th>
<th class="head">必要なケース</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>css/theme.default.css</td>
<td>常に必要</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id67">
<caption><span class="caption-text">tablesorterモジュール</span><a class="headerlink" href="#id67" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">ファイル名</th>
<th class="head">必要なケース</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>js/jquery.tablesorter.js</td>
<td>常に必要</td>
</tr>
<tr class="row-odd"><td>js/widgets/widget-scroller.js</td>
<td>ヘッダの固定を実現する場合</td>
</tr>
<tr class="row-even"><td>js/widgets/widget-editable.js</td>
<td>データの編集機能を要する場合</td>
</tr>
<tr class="row-odd"><td>addons/pager/jquery.tablesorter.pager.js</td>
<td>ページネーション機能を要する場合</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">基本構成サンプルではdefaut.jsを読み込んでいるが、以降の節ではそれぞれ実装したJavaScriptファイルを読み込む。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>SlickGridではJavaScriptでセルの値を設定するのに対し、tablesorterではHTMLに直接マークアップするのが基本的な使い方である。</p>
<p class="last">この仕組みのため、tablesorterではページのロード時に、tablesorterの処理が適用前のテーブルが一時的に表示されることがある。これを防ぎたい場合は、<code class="docutils literal"><span class="pre">table</span></code>要素のスタイルに<code class="docutils literal"><span class="pre">display:</span> <span class="pre">none</span></code>を指定した上で、JavaScriptで <code class="docutils literal"><span class="pre">$('#tablesorter').tablesorter().show()</span></code> のように記述することで、tablesorterの処理が完了後に表示されるようにすればよい。</p>
</div>
</div>
</div>
<div class="section" id="insert-and-delete-row">
<span id="id9"></span><h2>4.2. 行追加・削除・編集<a class="headerlink" href="#insert-and-delete-row" title="Permalink to this headline">¶</a></h2>
<div class="section" id="insert-and-delete-row-overview">
<span id="id10"></span><h3>4.2.1. 概要<a class="headerlink" href="#insert-and-delete-row-overview" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGridおよびtablesorterを用いて、テーブルのデータ行の追加・削除を行う方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/insert-and-delete-row.html">SlickGridによる行追加・削除・編集サンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
<tr class="row-odd"><td>tablesorter</td>
<td><a class="reference external" href="../samples/tablesorter/insert-and-delete-row.html">tablesorterによる行追加・削除・編集サンプル</a></td>
<td><ul class="first last simple">
<li><a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-pager.html">jQuery plugin: Tablesorter 2.0 - Pager plugin</a></li>
<li><a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-widget-editable.html">jQuery plugin: Tablesorter 2.0 - Content Editable</a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="insert-and-delete-row-howtouse">
<span id="id14"></span><h3>4.2.2. 利用方法<a class="headerlink" href="#insert-and-delete-row-howtouse" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id15">
<h4>4.2.2.1. SlickGridによる行追加・削除・編集サンプル<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h4>
<p>行追加・削除・編集のためのユーザインタフェースにはいくつかのパターンが考えられるが、
この例では、次のユーザインタフェースでの実現方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">行追加</th>
<td>テーブルの最下行にデータ追加用の空白行を設ける。</td>
</tr>
<tr class="row-even"><th class="stub">行削除</th>
<td>各行の最後のカラムにデータ削除ボタンを設ける。</td>
</tr>
<tr class="row-odd"><th class="stub">データ編集</th>
<td><ul class="first last simple">
<li>カーソルキーで選択セルを移動できる。</li>
<li>セル選択状態でエンターキー、またはセルのダブルクリックで編集モードに入る。</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id68">
<img alt="行追加・削除・編集ユーザインタフェース例" src="../_images/insert-and-delete-row-slickgrid.png" />
<p class="caption"><span class="caption-text"><strong>図: 行追加・削除・編集ユーザインタフェース例</strong></span></p>
</div>
<p><a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>に示したHTMLに加え、次のモジュールを読み込む。それ以外は同様なので省略する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slick.editors.js</td>
<td>データの編集機能を提供する。</td>
</tr>
</tbody>
</table>
<p>JavaScript(insert-and-delete-row.js)では、ユーザインタフェースの操作によって発生するイベントを監視し、行データの追加・削除を行う。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// insert-and-delete-row.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// SlickGridのカラム定義</span>
  <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>

    <span class="c1">// (1) データのテキスト編集を可能にするため `editor` プロパティに `Slick.Editors.Text` を指定する。</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">editor</span><span class="o">:</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Editors</span><span class="p">.</span><span class="nx">Text</span> <span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="nx">editor</span><span class="o">:</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Editors</span><span class="p">.</span><span class="nx">Text</span> <span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;% Complete&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;percentComplete&#39;</span><span class="p">,</span> <span class="nx">editor</span><span class="o">:</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Editors</span><span class="p">.</span><span class="nx">Text</span> <span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">editor</span><span class="o">:</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Editors</span><span class="p">.</span><span class="nx">Text</span> <span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Finish&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="nx">editor</span><span class="o">:</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Editors</span><span class="p">.</span><span class="nx">Text</span> <span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;effort-driven&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Effort Driven&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;effortDriven&#39;</span><span class="p">,</span> <span class="nx">editor</span><span class="o">:</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Editors</span><span class="p">.</span><span class="nx">Text</span> <span class="p">},</span>

    <span class="c1">// (2) 削除ボタンを表示するためのカラムを定義</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;削除&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">cssClass</span><span class="o">:</span> <span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
     <span class="nx">formatter</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="s1">&#39;&lt;button class=&quot;delete-button&quot;&gt;x&lt;/button&gt;&#39;</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// SlickGrid動作オプション</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// (3) 編集可能にする。</span>
    <span class="nx">editable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

    <span class="c1">// (4) セル選択時に自動的に編集モードにしない。</span>
    <span class="nx">autoEdit</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

    <span class="c1">// (5) 行追加を可能にする。</span>
    <span class="nx">enableAddRow</span><span class="o">:</span> <span class="kc">true</span>
  <span class="p">};</span>

  <span class="c1">// 5件のサンプルデータ作成</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;タスク &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">duration</span><span class="o">:</span> <span class="s1">&#39;5 days&#39;</span><span class="p">,</span>
      <span class="nx">percentComplete</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
      <span class="nx">start</span><span class="o">:</span> <span class="s1">&#39;01/01/2009&#39;</span><span class="p">,</span>
      <span class="nx">finish</span><span class="o">:</span> <span class="s1">&#39;01/05/2009&#39;</span><span class="p">,</span>
      <span class="nx">effortDriven</span><span class="o">:</span> <span class="mi">1</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">formatDate</span><span class="p">(</span><span class="nx">date</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">date</span><span class="p">.</span><span class="nx">getMonth</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>
      <span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">date</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span>
      <span class="nx">date</span><span class="p">.</span><span class="nx">getFullYear</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="c1">// 新規追加されるアイテムのデフォルト値</span>
  <span class="kd">var</span> <span class="nx">defaultData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;未設定&#39;</span><span class="p">,</span>
    <span class="nx">duration</span><span class="o">:</span> <span class="s1">&#39;未設定&#39;</span><span class="p">,</span>
    <span class="nx">percentComplete</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">start</span><span class="o">:</span> <span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()),</span>
    <span class="nx">finish</span><span class="o">:</span> <span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1000</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">24</span><span class="p">)),</span>
    <span class="nx">effortDriven</span><span class="o">:</span> <span class="s1">&#39;false&#39;</span>
  <span class="p">};</span>

  <span class="c1">// 画面初期化処理</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// SlickGridテーブルを作成</span>
    <span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="c1">// (6) クリックイベントハンドラ</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">onClick</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">hasClass</span><span class="p">(</span><span class="s1">&#39;delete-button&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">data</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidate</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>

    <span class="c1">// (7) 行追加イベントハンドラ</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">onAddNewRow</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// 追加されたアイテムにデフォルト値を設定してデータに追加し、更新する。</span>
      <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">defaultData</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">item</span><span class="p">);</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">updateRowCount</span><span class="p">();</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidateRow</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>行追加機能は、ソースコードリスト上の(5)・(7)で実現している。
(5)でオプション<code class="docutils literal"><span class="pre">enableAddRow</span></code>を<code class="docutils literal"><span class="pre">true</span></code>にすることで、最下行にデータ追加用の空白行が表示されるようになり、
空白行に新たなデータが入力された際に<code class="docutils literal"><span class="pre">onAddNewRow</span></code>イベントが発生するようになる。このイベントを(7)で監視し、
空白行へ追加されたデータを<code class="docutils literal"><span class="pre">data</span></code>に追加して、テーブルを再描画している。</p>
<p>行削除機能は、(2)・(6)で実現している。
(2)のカラム定義では<code class="docutils literal"><span class="pre">formatter</span></code>プロパティにHTML文字列を返す関数を指定して、<code class="docutils literal"><span class="pre">delete-button</span></code>クラスを持つ
行削除用ボタンを作成している。このように<code class="docutils literal"><span class="pre">formatter</span></code>プロパティに任意の文字列を返す関数を指定することで、
該当するカラムの各セル内にレンダリングされるHTMLを変更できる。
またテーブルがクリックされた際に発生する<code class="docutils literal"><span class="pre">onClick</span></code>イベントを(6)で監視し、
もしクリックされた要素が(2)で作成した<code class="docutils literal"><span class="pre">delete-button</span></code>クラスを持つボタンであれば、クリックされた行のデータを
<code class="docutils literal"><span class="pre">data</span></code>から削除して、テーブルを再描画している。</p>
<p>データ編集機能は、(1)・(3)・(4)で実現している。
(1)のカラム定義では<code class="docutils literal"><span class="pre">editor</span></code>プロパティにテキスト編集を可能にする<code class="docutils literal"><span class="pre">Slick.Editors.Text</span></code><a class="footnote-reference" href="#slickgrid-editors" id="id16">[4]</a>を指定し、
(3)でオプション<code class="docutils literal"><span class="pre">editable</span></code>を<code class="docutils literal"><span class="pre">true</span></code>にすることで、セルのデータ編集が可能になる。
またカーソルキーで選択セルを移動できるようにするため、(4)でオプション<code class="docutils literal"><span class="pre">autoEdit</span></code>を<code class="docutils literal"><span class="pre">false</span></code>にして
セル選択時に自動的に編集モードに入らないようにしている。</p>
<table class="docutils footnote" frame="void" id="slickgrid-editors" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id16">[4]</a></td><td>テキスト編集をする<code class="docutils literal"><span class="pre">Slick.Editors.Text</span></code>以外にも、数値を編集する<code class="docutils literal"><span class="pre">Slick.Editors.Integer</span></code>、日付を編集する<code class="docutils literal"><span class="pre">Slick.Editors.Date</span></code>などの編集用オブジェクトが提供されている。ただしドキュメントが整備されていないため、何が利用できるかは<a class="reference external" href="https://github.com/6pac/SlickGrid/blob/master/slick.editors.js">slick.editors.jsのソースコード</a>を参照する必要がある。</td></tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>SlickGridでは、データの追加や削除などを画面に反映するために<code class="docutils literal"><span class="pre">invalidate</span></code>および<code class="docutils literal"><span class="pre">render</span></code>などのメソッドを実行する必要がある。
その際に使用するメソッドを以下に示す。</p>
<blockquote class="last">
<div><table border="1" class="colwidths-given docutils" id="id69">
<caption><span class="caption-text">SlickGridの主なメソッド</span><a class="headerlink" href="#id69" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メソッド名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki/Slick.Grid#render">grid.render()</a></td>
<td>再描画対象になっている行を再描画する。再描画対象を設定するには<code class="docutils literal"><span class="pre">invalidateRow</span></code>などのメソッドを使用する。</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki/Slick.Grid#invalidateRow">grid.invalidateRow(Number)</a></td>
<td>特定行を再描画対象にする。引数には行インデックス番号(0から開始)を示す数値を与える。</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki/Slick.Grid#invalidateRows">grid.invalidateRows(Array&lt;Number&gt;)</a></td>
<td>複数の特定行を再描画対象にする。引数には行インデックス番号(0から開始)を示す数値の配列を与える。</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki/Slick.Grid#invalidateAllRows">grid.invalidateAllRows()</a></td>
<td>全ての行を再描画対象にする。</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki/Slick.Grid#invalidate">grid.invalidate()</a></td>
<td>すべての行を再描画する。<code class="docutils literal"><span class="pre">render</span></code>メソッドを実行しなくても再描画される。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
<div class="section" id="id17">
<h4>4.2.2.2. tablesorterによる行追加・削除・編集サンプル<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h4>
<p>この例では、次のユーザインタフェースを設けることで実現する方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">行追加</th>
<td>ボタンクリックで、テーブルの最下行にデータを追加する。</td>
</tr>
<tr class="row-even"><th class="stub">行削除</th>
<td>各行の最後のカラムにデータ削除ボタンを設ける。</td>
</tr>
<tr class="row-odd"><th class="stub">データ編集</th>
<td>セルをクリックすると編集モードに入る。</td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id70">
<img alt="行追加・削除・編集ユーザインタフェース例" src="../_images/insert-and-delete-row-tablesorter.png" />
<p class="caption"><span class="caption-text"><strong>図: 行追加・削除・編集ユーザインタフェース例</strong></span></p>
</div>
<p><a class="reference internal" href="#basic-usages-tablesorter"><span class="std std-ref">tablesorter基本構成サンプル</span></a>で示したHTMLに加え、次のモジュールを読み込む。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>widget-scroller.js</td>
<td>データの編集機能を提供する。</td>
</tr>
</tbody>
</table>
<p>また、各データ行に削除ボタンを用意する。以下に該当箇所を抜粋する。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>    <span class="c">&lt;!-- tablesorterを使用するテーブル --&gt;</span>
    <span class="p">&lt;</span><span class="nt">table</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;tablesorter&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">thead</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>姓<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>名<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>年齢<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;</span><span class="nt">th</span><span class="p">&gt;</span>削除<span class="p">&lt;/</span><span class="nt">th</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">thead</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">tbody</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>毛利<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>正雄<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>28<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>安田<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>さとみ<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>28<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>坂<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>文夫<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>45<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>小本<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>里香<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>18<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>中居<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>大輔<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>23<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>木久<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>なみ<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>28<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>大西<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>昌子<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>31<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>岩佐<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>純子<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>45<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>清水<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>一久<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>19<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>山峰<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>行紀<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">div</span><span class="p">&gt;</span>63<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;remove-btn&quot;</span><span class="p">&gt;</span>x<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
      <span class="p">&lt;/</span><span class="nt">tbody</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>JavaScript(insert-and-delete-row.js)では、ユーザインタフェースの操作から行データの追加・削除・編集を行う。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="cm">/* jshint camelcase: false */</span>
<span class="cm">/* eslint camelcase: 0 */</span>
<span class="c1">// insert-and-delete-row.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// テーブルにtablesorterを適用する。</span>
  <span class="kd">var</span> <span class="nx">$tablesorter</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tablesorter&#39;</span><span class="p">).</span><span class="nx">tablesorter</span><span class="p">({</span>

    <span class="c1">// （1）編集機能の設定</span>
    <span class="nx">widgets</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;editable&#39;</span><span class="p">],</span>
    <span class="nx">widgetOptions</span><span class="o">:</span> <span class="p">{</span>

      <span class="c1">// 編集可能なカラムを設定</span>
      <span class="nx">editable_columns</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>

      <span class="c1">// 編集後にEnterキー押下で編集完了とする。</span>
      <span class="nx">editable_enterToAccept</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

      <span class="c1">// 編集後の自動ソートを無効にする。</span>
      <span class="nx">editable_autoResort</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">}</span>
  <span class="p">});</span>

  <span class="c1">// 行の追加ボタンのイベント</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#add-btn&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="s1">&#39;&lt;tr&gt;&lt;td&gt;&lt;div&gt;姓&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;div&gt;名&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;div&gt;&#39;</span> <span class="o">+</span> <span class="nx">age</span> <span class="o">+</span>
          <span class="s1">&#39;&lt;/div&gt;&lt;/td&gt;&lt;td&gt;&lt;button class=&quot;remove-btn&quot;&gt;X&lt;/button&gt;&lt;/td&gt;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">$row</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>

    <span class="c1">// テーブルに行を追加する。</span>
    <span class="nx">$tablesorter</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;tbody&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$row</span><span class="p">);</span>

    <span class="c1">// （2）追加した行をtablesorterに認識させる。</span>
    <span class="nx">$tablesorter</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;addRows&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">$row</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

      <span class="c1">// （3）追加した行を修正可能にする。</span>
      <span class="nx">$tablesorter</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;refreshWidgets&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}]);</span>
  <span class="p">});</span>

  <span class="c1">// 行の削除ボタンのイベント</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;button.remove-btn&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// テーブルから行の削除</span>
    <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">closest</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>

    <span class="c1">// （4）データの削除をtablesorterに認識させる。</span>
    <span class="nx">$tablesorter</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;update&#39;</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>行追加機能は、 データ行の<code class="docutils literal"><span class="pre">tr</span></code>要素をテーブルの<code class="docutils literal"><span class="pre">tbody</span></code>に追加した後、ソースコードリスト上の(2)で<code class="docutils literal"><span class="pre">addRows</span></code>イベントを発生させることで、行が追加されたことをtablesorterに認識させる。</p>
<p>行削除機能は、 テーブルの<code class="docutils literal"><span class="pre">tbody</span></code>から データ行の<code class="docutils literal"><span class="pre">tr</span></code>を削除した後、ソースコードリスト上の(4)で<code class="docutils literal"><span class="pre">update</span></code>イベントを発生させることで、行が削除されたことをtablesorterに認識させる。</p>
<p>データ編集機能は、ソースコードリスト上の(1)・(3)で実現している。
(1)で<code class="docutils literal"><span class="pre">widgets</span></code>の配列に<code class="docutils literal"><span class="pre">'editable'</span></code>を追加することで、データ編集機能の利用が可能になる。また、<code class="docutils literal"><span class="pre">widgetOptions</span></code>で編集時の動作を設定している。
(3)では、後から追加された行も編集可能とするために<code class="docutils literal"><span class="pre">refreshWidgets</span></code>イベントを発生させている。ただしこの処理は行追加が終わった後に実行される必要があるため、(2)のコールバック関数として指定している。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">tablesorterはデータ編集を実現するために、<code class="docutils literal"><span class="pre">contentEditable</span></code>属性を用いているが、Internet Explorerでは<code class="docutils literal"><span class="pre">contentEditable</span></code>属性を<code class="docutils literal"><span class="pre">td</span></code>要素へ設定することができない。
そのため、セルの値を<code class="docutils literal"><span class="pre">contentEditable</span></code>属性を設定できる<code class="docutils literal"><span class="pre">div</span></code>要素や<code class="docutils literal"><span class="pre">span</span></code>要素内に記述する必要がある。
なお、このサンプルでは<code class="docutils literal"><span class="pre">div</span></code>要素を用いて実装している。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>tablesorterでは、データの追加や削除などを行った後、それらの状態変化をtablesorterに認識させる必要がある。その際に発生させるイベント名を以下に示す。</p>
<p>なお、tablesorterの公式リファレンスでは、これらの手動で発生させるイベントのことを <em>method</em> と表現しているため、参照する際は注意すること。本ガイドラインでもこれにならって <em>メソッド</em> と表現する。</p>
<blockquote class="last">
<div><table border="1" class="colwidths-given docutils" id="id71">
<caption><span class="caption-text">tablesorterの主なメソッド</span><a class="headerlink" href="#id71" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">メソッド名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/index.html#addrows">addRows</a></td>
<td>行を追加する際に実行する。tablesorterがキャッシュしているテーブル情報を更新する。</td>
</tr>
<tr class="row-odd"><td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/index.html#addrows">update</a></td>
<td>行の削除する際に実行する。tablesorterがキャッシュしているテーブル情報を更新する。</td>
</tr>
<tr class="row-even"><td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/index.html#refreshwidgets">refreshWidgets</a></td>
<td>設定されているウィジェットを削除し、再設定する際に実行する。</td>
</tr>
</tbody>
</table>
</div></blockquote>
</div>
</div>
</div>
</div>
<div class="section" id="move-row">
<span id="id18"></span><h2>4.3. 行の並び替え<a class="headerlink" href="#move-row" title="Permalink to this headline">¶</a></h2>
<div class="section" id="move-row-outline">
<span id="id19"></span><h3>4.3.1. 概要<a class="headerlink" href="#move-row-outline" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGridを用いて、行の並び替えを行う方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/move-row.html">SlickGridによる行の並び替えサンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="move-row-howtouse">
<span id="id22"></span><h3>4.3.2. 利用方法<a class="headerlink" href="#move-row-howtouse" title="Permalink to this headline">¶</a></h3>
<p>行の並び替えをするためには、SlickGridに関連付けられたデータ配列の中身を並び替えてテーブルを再描画すればよい。
概念的にはシンプルだが、複数行の一括並び替えなどを実現する場合は、並び替えの処理に複雑な実装が必要となる。</p>
<p>この例では、次のユーザインタフェースでの実現方法を説明する。</p>
<ul class="simple">
<li>行ドラッグアンドドロップ操作による並び替えができる</li>
<li>Ctrl または Shift クリックで複数行を選択して一括で並び替えができる</li>
</ul>
<p><a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>で示したHTMLに加え、次のモジュールを読み込む。それ以外は同様なので省略する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slick.editors.js</td>
<td>行のドラッグアンドドロップ操作ができるユーザインタフェースを提供する</td>
</tr>
<tr class="row-odd"><td>slick.rowselectionmodel.js</td>
<td>行選択機能を提供する</td>
</tr>
</tbody>
</table>
<p>JavaScript(move-row.js)では、ユーザインタフェースの操作によって発生するイベントを監視し、行データの並び替えとテーブルの再描画を行う。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// move-row.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// SlickGridのカラム定義</span>
  <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>

    <span class="c1">// (1) 行ドラッグアンドドロップ機能を有効化するため、すべてのカラムに `behavior: &#39;selectAndMove&#39;` を設定する。</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="nx">behavior</span><span class="o">:</span> <span class="s1">&#39;selectAndMove&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="nx">behavior</span><span class="o">:</span> <span class="s1">&#39;selectAndMove&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;% Complete&#39;</span><span class="p">,</span> <span class="nx">behavior</span><span class="o">:</span> <span class="s1">&#39;selectAndMove&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;percentComplete&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="nx">behavior</span><span class="o">:</span> <span class="s1">&#39;selectAndMove&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Finish&#39;</span><span class="p">,</span> <span class="nx">behavior</span><span class="o">:</span> <span class="s1">&#39;selectAndMove&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;effort-driven&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Effort Driven&#39;</span><span class="p">,</span> <span class="nx">behavior</span><span class="o">:</span> <span class="s1">&#39;selectAndMove&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;effortDriven&#39;</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// SlickGridの動作オプション</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// 何も指定しない。</span>
  <span class="p">};</span>

  <span class="c1">// 1000件のサンプルデータ作成</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;タスク &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">duration</span><span class="o">:</span> <span class="s1">&#39;5 days&#39;</span><span class="p">,</span>
      <span class="nx">percentComplete</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
      <span class="nx">start</span><span class="o">:</span> <span class="s1">&#39;01/01/2009&#39;</span><span class="p">,</span>
      <span class="nx">finish</span><span class="o">:</span> <span class="s1">&#39;01/05/2009&#39;</span><span class="p">,</span>
      <span class="nx">effortDriven</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 画面初期化処理</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// SlickGridテーブルを作成</span>
    <span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="c1">// (2) 行選択機能のプラグインを追加</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">setSelectionModel</span><span class="p">(</span><span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">RowSelectionModel</span><span class="p">());</span>

    <span class="c1">// (3) 行ドラッグアンドドロップ移動機能のプラグインを追加</span>
    <span class="kd">var</span> <span class="nx">moveRowsPlugin</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">RowMoveManager</span><span class="p">();</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">registerPlugin</span><span class="p">(</span><span class="nx">moveRowsPlugin</span><span class="p">);</span>

    <span class="c1">// (4) 行ドラッグアンドドロップイベントハンドラ</span>
    <span class="c1">//     移動操作を受けた行を、移動先の位置に挿入して並び替える処理を実装する。</span>
    <span class="nx">moveRowsPlugin</span><span class="p">.</span><span class="nx">onMoveRows</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>

          <span class="c1">// 移動操作を受けた行のインデックス番号</span>
          <span class="nx">rows</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">rows</span><span class="p">,</span>

          <span class="c1">// 移動先の行のインデックス番号</span>
          <span class="nx">insertBefore</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">insertBefore</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">right</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">insertBefore</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>

      <span class="c1">// 複数行選択時の選択順を、行のインデックス番号の小さい順でソート</span>
      <span class="kd">var</span> <span class="nx">extractedRows</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">rows</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span><span class="p">;</span> <span class="p">});</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">extractedRows</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">]]);</span>
      <span class="p">}</span>

      <span class="c1">// データ全体のソート</span>
      <span class="nx">rows</span><span class="p">.</span><span class="nx">reverse</span><span class="p">();</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">row</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">row</span> <span class="o">&lt;</span> <span class="nx">insertBefore</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">left</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">row</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">right</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">row</span> <span class="o">-</span> <span class="nx">insertBefore</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">data</span> <span class="o">=</span> <span class="nx">left</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">extractedRows</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">right</span><span class="p">));</span>

      <span class="c1">// 選択状態を復元</span>
      <span class="kd">var</span> <span class="nx">selectedRows</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">selectedRows</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">left</span><span class="p">.</span><span class="nx">length</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="c1">// データと画面を更新する。</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">resetActiveCell</span><span class="p">();</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">setData</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">setSelectedRows</span><span class="p">(</span><span class="nx">selectedRows</span><span class="p">);</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidate</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>行のドラッグアンドドロップ操作は、ソースコードリスト上の(1)・(3)・(4)で実現している。
(3)でドラッグアンドドロップ操作を実現するプラグインをテーブルにセットした上で、(1)のカラム定義で
<code class="docutils literal"><span class="pre">behavior</span></code>プロパティに<code class="docutils literal"><span class="pre">'selectAndMove'</span></code>を設定する。
これによりドロップアンドドロップ操作が可能となり、また操作後には<code class="docutils literal"><span class="pre">onMoveRows</span></code>イベントが発生するようになる。
このイベントを(4)で監視し、コールバック関数内でデータの並び替えと再描画を行っている。</p>
<p>複数行の一括並び替え機能は、(2)・(4)で実現している。
(2)では行選択機能を提供するプラグインをテーブルにセットしている。
(4)ではデータ配列を並び替えてテーブルを再描画している。
並び替えの処理は、複数行の一括の並び替えなど、様々な操作条件に対応するため複雑な実装になっているが、
SlickGridの使用方法の説明という目的から外れるため、この部分の説明は割愛する。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>このサンプルでは、複数行を選択して一括で並び替えを行う操作(1行目と4行目を選択し、2行目に移動するなど)を実現しているが、並び替えのロジックはライブラリから提供されていない。ライブラリが提供しているのは、「複数行の選択状態を管理する機能」と「ドラッグアンドドロップ操作によりイベントを発生させる機能」であり、これらの機能と独自実装した並び替えのロジックを組み合せて実現している。</p>
<p class="last">この他にも、SlickGridはロジックの独自実装に活用できるインタフェースや独自イベントを提供していることから、フレームワークとしての性質が強い。</p>
</div>
</div>
</div>
<div class="section" id="fixed-header">
<span id="id23"></span><h2>4.4. ヘッダを固定したデータ行のスクロール<a class="headerlink" href="#fixed-header" title="Permalink to this headline">¶</a></h2>
<div class="section" id="fixed-header-outline">
<span id="id24"></span><h3>4.4.1. 概要<a class="headerlink" href="#fixed-header-outline" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGrid、tablesorterを用いてヘッダを固定してデータ行をスクロールする実装方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/default.html">SlickGridによるヘッダを固定したデータ行のスクロールサンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
<tr class="row-odd"><td>tablesorter</td>
<td><a class="reference external" href="../samples/tablesorter/fixed-header.html">tablesorterによるヘッダを固定したデータ行のスクロールサンプル</a></td>
<td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-widget-scroller.html">jQuery plugin: Tablesorter 2.0 - Scroller Widget</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="fixed-header-howtouse">
<span id="id28"></span><h3>4.4.2. 利用方法<a class="headerlink" href="#fixed-header-howtouse" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id29">
<h4>4.4.2.1. SlickGridによるヘッダを固定したデータ行のスクロール<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h4>
<p>SlickGridは標準でヘッダが固定されるため、特別な考慮は不要である。よって<a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>を参照すること。</p>
</div>
<div class="section" id="id30">
<h4>4.4.2.2. tablesorterによるヘッダを固定したデータ行のスクロール<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#basic-usages-tablesorter"><span class="std std-ref">tablesorter基本構成サンプル</span></a>で示したHTMLに加え、次のモジュールを読み込む。それ以外は同様なので省略する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>widget-scroller.js</td>
<td>ヘッダ固定機能を提供する。</td>
</tr>
</tbody>
</table>
<p>JavaScript(fixed-header.js)では、テーブル要素に対し<code class="docutils literal"><span class="pre">tablesorter</span></code>メソッドを実行する。ヘッダの<code class="docutils literal"><span class="pre">thead</span></code>要素を固定するためには<code class="docutils literal"><span class="pre">tablesorter</span></code>メソッドのオプションである<code class="docutils literal"><span class="pre">widgets</span></code>配列に<code class="docutils literal"><span class="pre">'scroller'</span></code>を追加する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="cm">/* jshint camelcase: false */</span>
<span class="cm">/* eslint camelcase: 0 */</span>
<span class="c1">// fixed-header.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// ヘッダを固定するテーブルに対し、tablesorterメソッドを実行する。</span>
  <span class="c1">// その際、widgetsプロパティに[&#39;scroller&#39;]を設定する。</span>
  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tablesorter&#39;</span><span class="p">).</span><span class="nx">tablesorter</span><span class="p">({</span>
    <span class="nx">widgets</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;scroller&#39;</span><span class="p">],</span>
    <span class="nx">widgetOptions</span><span class="o">:</span> <span class="p">{</span>

      <span class="c1">// テーブルの髙さの指定</span>
      <span class="nx">scroller_height</span> <span class="o">:</span> <span class="mi">200</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">widgetOptions</span></code>プロパティでテーブル要素の高さを設定できる<code class="docutils literal"><span class="pre">scroller_height</span></code>などオプションが提供されている。これらの詳細について知りたい場合は、 <a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-widget-scroller.html">tablesorterの公式ウェブサイトのリファレンス</a> を参照すること。</p>
</div>
</div>
</div>
<div class="section" id="pagination">
<span id="id31"></span><h2>4.5. ページネーション<a class="headerlink" href="#pagination" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pagination-outline">
<span id="id32"></span><h3>4.5.1. 概要<a class="headerlink" href="#pagination-outline" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGridおよびtablesorterを用いて、テーブル表示データのページネーションを行う方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/pagination.html">SlickGridによるページネーションサンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
<tr class="row-odd"><td>tablesorter</td>
<td><a class="reference external" href="../samples/tablesorter/pagination.html">tablesorterによるページネーションサンプル</a></td>
<td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-pager.html">jQuery plugin: Tablesorter 2.0 - Pager plugin</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="pagination-howtouse">
<span id="id37"></span><h3>4.5.2. 利用方法<a class="headerlink" href="#pagination-howtouse" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id38">
<h4>4.5.2.1. SlickGridによるページネーション<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>で示したHTMLに加え、次のモジュールを読み込む。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slick.dataview.js</td>
<td>データの表示条件を詳細に設定するための部品<code class="docutils literal"><span class="pre">DataView</span></code>を提供する</td>
</tr>
<tr class="row-odd"><td>slick.pager.js</td>
<td>ページネーション操作を行うためのコントロール部品を提供する</td>
</tr>
</tbody>
</table>
<p>また、ページネーションコントロールを表示する領域を追加する。
ただし、ページネーションコントロールの中身はライブラリが自動生成するため、HTMLにマークアップする必要はない。</p>
<p>以下に該当個所を抜粋する。それ以外は <a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a> で説明した基本構成と同じなので省略する。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;border&quot;</span><span class="p">&gt;</span>

  <span class="c">&lt;!-- SlickGridテーブルの表示領域となる要素 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;myGrid&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;grid&quot;</span> <span class="na">style</span><span class="o">=</span><span class="s">&quot;grid&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>

  <span class="c">&lt;!-- SlickGridページネーションコントロールの表示領域となる要素 --&gt;</span>
  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;pager&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>JavaScript(pagination.js)では、ページ切り替え操作によって発生するイベントを監視し、データの表示範囲・件数を切り替えている。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// pagination.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// SlickGridカラム設定</span>
  <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;% Complete&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;percentComplete&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Finish&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;effort-driven&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Effort Driven&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;effortDriven&#39;</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// SlickGrid動作オプション</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// 何も指定しない。</span>
  <span class="p">};</span>

  <span class="c1">// データ作成部</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>

      <span class="c1">// DataViewを使用する際はidの設定が必須なことに注意</span>
      <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;id_&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;タスク &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">duration</span><span class="o">:</span> <span class="s1">&#39;5 days&#39;</span><span class="p">,</span>
      <span class="nx">percentComplete</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
      <span class="nx">start</span><span class="o">:</span> <span class="s1">&#39;01/01/2009&#39;</span><span class="p">,</span>
      <span class="nx">finish</span><span class="o">:</span> <span class="s1">&#39;01/05/2009&#39;</span><span class="p">,</span>
      <span class="nx">effortDriven</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// (1) DataViewオブジェクトを生成</span>
    <span class="kd">var</span> <span class="nx">dataView</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Data</span><span class="p">.</span><span class="nx">DataView</span><span class="p">();</span>
    <span class="nx">dataView</span><span class="p">.</span><span class="nx">beginUpdate</span><span class="p">();</span>
    <span class="nx">dataView</span><span class="p">.</span><span class="nx">setItems</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="nx">dataView</span><span class="p">.</span><span class="nx">endUpdate</span><span class="p">();</span>

    <span class="c1">// SlickGridテーブルを作成</span>
    <span class="c1">// コンストラクタの引数には `data` の代わりに `dataView` を渡す。</span>
    <span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">dataView</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="c1">// (2) ページネーション機能のプラグインを追加</span>
    <span class="kd">var</span> <span class="nx">$pager</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pager&#39;</span><span class="p">);</span>
    <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Controls</span><span class="p">.</span><span class="nx">Pager</span><span class="p">(</span><span class="nx">dataView</span><span class="p">,</span> <span class="nx">grid</span><span class="p">,</span> <span class="nx">$pager</span><span class="p">);</span>

    <span class="c1">// (3) 表示行数が変更された際のイベントハンドラ</span>
    <span class="nx">dataView</span><span class="p">.</span><span class="nx">onRowCountChanged</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">updateRowCount</span><span class="p">();</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// (4) 表示行が変更された際のイベントハンドラ</span>
    <span class="nx">dataView</span><span class="p">.</span><span class="nx">onRowsChanged</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidateRows</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>

    <span class="c1">// 25件ごと表示する(ドキュメントには載っていないAPIのため注意)。</span>
    <span class="nx">dataView</span><span class="p">.</span><span class="nx">setPagingOptions</span><span class="p">({</span><span class="nx">pageSize</span><span class="o">:</span> <span class="mi">25</span><span class="p">});</span>

    <span class="c1">// ページネーションパネルを表示状態にする。</span>
    <span class="nx">$pager</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.slick-pager-settings-expanded&#39;</span><span class="p">).</span><span class="nx">toggle</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>

  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>ソースコードリスト上の(1)で、データの表示条件を詳細に設定するための部品<code class="docutils literal"><span class="pre">DataView</span></code>オブジェクトを生成し、
これに実際のデータ<code class="docutils literal"><span class="pre">data</span></code>をセットしている。<code class="docutils literal"><span class="pre">DataView</span></code>は ページネーションコントロールを作成する
<code class="docutils literal"><span class="pre">Slick.Controls.Pager</span></code>コンストラクタを実行するために必要になる。</p>
<p>(2)では<code class="docutils literal"><span class="pre">Slick.Controls.Pager</span></code>コンストラクタを次のシグネチャに従って実行する。</p>
<dl class="function">
<dt>
<code class="descclassname">Slick.Controls.</code><code class="descname">Pager</code><span class="sig-paren">(</span><em>dataView</em>, <em>grid</em>, <em>$container</em><span class="sig-paren">)</span></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Arguments:</th><td class="field-body"><ul class="first last simple">
<li><strong>dataView</strong> (<em>DataView</em>) – テーブルのデータ表示に用いられている<code class="docutils literal"><span class="pre">DataView</span></code>オブジェクト</li>
<li><strong>grid</strong> (<em>SlickGrid</em>) – SlickGridテーブルオブジェクト</li>
<li><strong>$container</strong> (<em>jQuery</em>) – ページネーションコントロールを表示する要素を選択したjQueryオブジェクト</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<p>これにより、ページ切り替え操作によって<code class="docutils literal"><span class="pre">dataView</span></code>上で次のイベントが発生するようになる。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">イベント名</th>
<th class="head">発生契機</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">onRowCountChanged</span></code></td>
<td>ページネーションコントロールでデータ表示行数が変更された際</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">onRowsChanged</span></code></td>
<td>ページネーションコントロールでデータ表示行数が変更された際、またはページ送りされた際</td>
</tr>
</tbody>
</table>
<p>これらのイベントを(3)および(4)で監視し、それぞれテーブル表示を更新している。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ページ切り替えのたびにリクエストする場合には、<code class="docutils literal"><span class="pre">onRowsChanged</span></code>イベントのタイミングでAjaxリクエストを実行し、レスポンスで得たデータを<code class="docutils literal"><span class="pre">dataView.setItems</span></code>メソッドを用いてセットすればよい。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">jQuery v.3.2.0以降の <a class="reference external" href="https://github.com/jquery/jquery/issues/3571">バグ</a> により、ページネーションのAutoを使用する際、表示行数が異なる可能性がある。
jQuery内部で、width()かheight()を取得できない場合、offsetHeight/Widthを設定することで回避はしているものの、
実際に取得できる値は同じではなく、offsetHeightはボーダーを含む高さであるため、
Auto選択時に表示される行数が表示領域に対して異なるという事象が発生します。</p>
</div>
</div>
<div class="section" id="id40">
<h4>4.5.2.2. TableSorterを用いた表示データのページネーション<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h4>
<p>この例では、次のユーザインタフェースを設けることで実現する方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><th class="stub">表示設定の変更</th>
<td>1ページに表示するデータ数の変更、ページ数の変更する部品を設ける。</td>
</tr>
<tr class="row-even"><th class="stub">ページの移動</th>
<td>ページを移動するボタンを設ける。</td>
</tr>
</tbody>
</table>
<div class="figure align-center" id="id72">
<img alt="ページネーションのユーザインタフェース例" src="../_images/pagination-tablesorter.png" />
<p class="caption"><span class="caption-text"><strong>図: ページネーションのユーザインタフェース例</strong></span></p>
</div>
<p><a class="reference internal" href="#basic-usages-tablesorter"><span class="std std-ref">tablesorter基本構成サンプル</span></a>で示したHTMLに加え、次のモジュールを読み込む。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>jquery.tablesorter.pager.js</td>
<td>ページネーション機能を提供する。</td>
</tr>
</tbody>
</table>
<p>また、ページネーションコントロールを追加する。</p>
<p>以下に該当個所を抜粋する。それ以外は<a class="reference internal" href="#basic-usages-tablesorter"><span class="std std-ref">tablesorter基本構成サンプル</span></a>で説明した基本構成と同じなので省略する。</p>
<div class="highlight-html"><div class="highlight"><pre><span></span>    <span class="c">&lt;!-- ページネーションコントロール --&gt;</span>
    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;pager&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pager&quot;</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">form</span><span class="p">&gt;</span>

        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>表示件数 :

          <span class="c">&lt;!-- 表示件数部品 --&gt;</span>
          <span class="p">&lt;</span><span class="nt">select</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pagesize&quot;</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">selected</span><span class="o">=</span><span class="s">&quot;selected&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;10&quot;</span><span class="p">&gt;</span>10<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;20&quot;</span><span class="p">&gt;</span>20<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;30&quot;</span><span class="p">&gt;</span>30<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;40&quot;</span><span class="p">&gt;</span>40<span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">label</span><span class="p">&gt;</span>ページ数 :

          <span class="c">&lt;!-- ページ選択部品 --&gt;</span>
          <span class="p">&lt;</span><span class="nt">select</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;gotoPage&quot;</span><span class="p">&gt;</span>
          <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">br</span><span class="p">/&gt;</span>

        <span class="c">&lt;!-- ページ移動部品 --&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.tablesorter/2.30.7/addons/pager/icons/first.png&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;first&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;first&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.tablesorter/2.30.7/addons/pager/icons/prev.png&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;prev&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;prev&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;pagedisplay&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.tablesorter/2.30.7/addons/pager/icons/next.png&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;next&quot;</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;../lib/vendor/jquery.tablesorter/2.30.7/addons/pager/icons/last.png&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;last&quot;</span> <span class="na">alt</span><span class="o">=</span><span class="s">&quot;last&quot;</span><span class="p">/&gt;</span>
      <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>ページネーションコントロールの表示件数部品、ページ数選択部品は、次のクラスを持つ<code class="docutils literal"><span class="pre">select</span></code>要素で構成する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">クラス</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">pagesize</span></code></td>
<td>1ページあたりの表示件数を制御する。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">gotoPage</span></code></td>
<td>ページを制御する。</td>
</tr>
</tbody>
</table>
<p>表示件数部品は<code class="docutils literal"><span class="pre">option</span></code>要素で選択する値を明示する必要があるが、ページ選択部品の値は自動的に計算される。</p>
<p>ページネーションコントロールのページ移動部品は、次のクラスを持つ要素で構成する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">クラス</th>
<th class="head">備考</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">first</span></code></td>
<td>最初のページに移動するための要素に付与する。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">prev</span></code></td>
<td>1つ前のページに移動するための要素に付与する。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">pagedisplay</span></code></td>
<td>現在のページ数を表示する要素に付与する。</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">next</span></code></td>
<td>1つ後のページに移動するための要素に付与する。</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">last</span></code></td>
<td>最後のページに移動するための要素に付与する。</td>
</tr>
</tbody>
</table>
<p>JavaScript(pagination.js)では、次の処理を行う。</p>
<ul class="simple">
<li>ページネーションを適用するテーブル要素をjQueryでセレクトし、<code class="docutils literal"><span class="pre">tablesorter</span></code>メソッドを実行する。</li>
<li><code class="docutils literal"><span class="pre">tablesorterPager</span></code>メソッドを実行する。その際<code class="docutils literal"><span class="pre">container</span></code>プロパティに、ページネーションコントロールを表示する要素を選択したjQueryオブジェクトを指定する。</li>
</ul>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// pagination.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// テーブルにtablesorterを適用する。</span>
  <span class="kd">var</span> <span class="nx">$tablesorter</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tablesorter&#39;</span><span class="p">).</span><span class="nx">tablesorter</span><span class="p">();</span>

  <span class="c1">// テーブルにページネーションを適用する。</span>
  <span class="nx">$tablesorter</span><span class="p">.</span><span class="nx">tablesorterPager</span><span class="p">({</span>

    <span class="c1">// ページネーションコントロールに対し設定する。</span>
    <span class="nx">container</span><span class="o">:</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pager&#39;</span><span class="p">)</span>
  <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">tablesorterPager</span></code>メソッドで設定できるプロパティは他にも提供されている。これらの詳細について知りたい場合は、 <a class="reference external" href="https://mottie.github.io/tablesorter/docs/index.html#pager-ajaxobject">tablesorterの公式ウェブサイトのリファレンス</a> を参照すること。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">ページ切り替え時にサーバから情報を取得することもできるが、その場合、クライアントでのソートができなくなるため、サーバサイドでソートを実装する必要がある。詳細は、 <a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-pager-ajax.html">tablesorterの公式ウェブサイトのリファレンス</a>を参照すること。</p>
</div>
</div>
</div>
</div>
<div class="section" id="sort">
<span id="id41"></span><h2>4.6. ソート<a class="headerlink" href="#sort" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sort-outline">
<span id="id42"></span><h3>4.6.1. 概要<a class="headerlink" href="#sort-outline" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGridおよびtablesorterを用いて、テーブルのデータのソートを行う方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/sort.html">SlickGridによるソートサンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
<tr class="row-odd"><td>tablesorter</td>
<td><a class="reference external" href="../samples/tablesorter/default.html">tablesorterによるソートサンプル</a></td>
<td><a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-widget-scroller.html">jQuery plugin: Tablesorter 2.0 - Scroller Widget</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="sort-howtouse">
<span id="id47"></span><h3>4.6.2. 利用方法<a class="headerlink" href="#sort-howtouse" title="Permalink to this headline">¶</a></h3>
<div class="section" id="id48">
<h4>4.6.2.1. SlickGridによるソート<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h4>
<p>HTMLは<a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>で説明した基本構成と同様なので、省略する。</p>
<p>JavaScript(sort.js)では、ヘッダのクリック操作からソートイベントを発生させ、ソート処理を実行する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// sort.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">len</span><span class="p">;</span>

  <span class="c1">// SlickGridのカラム定義</span>
  <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>

    <span class="c1">// (1) ソート機能を有効化するカラム定義に `sortable: true` を設定する。</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;ID&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">sortable</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;value 1&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;value1&#39;</span><span class="p">,</span> <span class="nx">sortable</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;value 2&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;value2&#39;</span><span class="p">,</span> <span class="nx">sortable</span><span class="o">:</span> <span class="kc">true</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;value3&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;value 3&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;value3&#39;</span><span class="p">,</span> <span class="nx">sortable</span><span class="o">:</span> <span class="kc">true</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// SlickGridの動作オプション</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// 何も指定しない。</span>
  <span class="p">};</span>

  <span class="c1">// 1000件のサンプルデータ作成</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;タスク&#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">value1</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
      <span class="nx">value2</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">),</span>
      <span class="nx">value3</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// ソート関数を定義</span>
  <span class="c1">// 文字列の場合は文字列比較を、数値の場合は数値比較をした結果でソートする。</span>
  <span class="kd">function</span> <span class="nx">sortfn</span><span class="p">(</span><span class="nx">o1</span><span class="p">,</span> <span class="nx">o2</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">o1</span><span class="p">[</span><span class="nx">column</span><span class="p">.</span><span class="nx">field</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">column</span><span class="p">.</span><span class="nx">field</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">o1</span><span class="p">[</span><span class="nx">column</span><span class="p">.</span><span class="nx">field</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">o2</span><span class="p">[</span><span class="nx">column</span><span class="p">.</span><span class="nx">field</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// (2) `data` を基にソート用インデックス `indicies` を作成</span>
  <span class="c1">//     データ表示時はこのインデックスを経由してデータを引き当てるようにしている。</span>
  <span class="kd">var</span> <span class="nx">indices</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="kd">var</span> <span class="nx">column</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">column</span> <span class="o">=</span> <span class="nx">columns</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="nx">indices</span><span class="p">[</span><span class="nx">column</span><span class="p">.</span><span class="nx">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">sortfn</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">indices</span><span class="p">[</span><span class="nx">column</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 画面初期化処理</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// ソート設定を保持する変数</span>
    <span class="kd">var</span> <span class="nx">isAsc</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>                  <span class="c1">// 初期設定は昇順</span>
    <span class="kd">var</span> <span class="nx">currentSortCol</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">};</span>  <span class="c1">// 初期設定は id カラムでソート</span>

    <span class="c1">// (3) データ引き当て関数。`Slick.Grid` コンストラクタの引数で使用</span>
    <span class="c1">//     ソート用インデックス `indices` を経由して表示データを引き当てる。</span>
    <span class="kd">function</span> <span class="nx">getItem</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">newIndex</span> <span class="o">=</span> <span class="nx">isAsc</span> <span class="o">?</span> <span class="nx">index</span> <span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">indices</span><span class="p">[</span><span class="nx">currentSortCol</span><span class="p">.</span><span class="nx">id</span><span class="p">][</span><span class="nx">newIndex</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="c1">// データ長取得関数。`Slick.Grid` コンストラクタの引数で使用</span>
    <span class="c1">// テーブルに表示するデータの長さは変更しないため、 ``data`` の長さを返す。</span>
    <span class="kd">function</span> <span class="nx">getLength</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// (4) SlickGridテーブルを作成</span>
    <span class="c1">//     第2引数に配列を指定する代わりに、 `getLength` および `getItem` 関数を持つオブジェクトを指定して</span>
    <span class="c1">//     ソート設定に基づきデータの表示を行う。</span>
    <span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">getLength</span><span class="o">:</span> <span class="nx">getLength</span><span class="p">,</span> <span class="nx">getItem</span><span class="o">:</span> <span class="nx">getItem</span><span class="p">},</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="c1">// (5) ソートイベントハンドラ</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">onSort</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// ソート設定を書き換える。</span>
      <span class="nx">isAsc</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">sortAsc</span><span class="p">;</span>
      <span class="nx">currentSortCol</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">sortCol</span><span class="p">;</span>

      <span class="c1">// テーブル全体を再描画</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidateAllRows</span><span class="p">();</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>ソート機能の実現は、ユーザインタフェース部とデータ表示ルール変更部から成り立つ。</p>
<p>ユーザインタフェース部は、ソースコードリスト上の(1)・(5)で実現している。
(1)でカラム定義のオプション<code class="docutils literal"><span class="pre">sortable</span></code>を<code class="docutils literal"><span class="pre">true</span></code>にすることで、ヘッダがクリックされた際にスタイルの変更や
<code class="docutils literal"><span class="pre">onSort</span></code>イベントが発生するようになる。このイベントを(5)で監視し、クリックされたヘッダのカラムを基に
ソート設定を書き換え、テーブル全体を再描画している。</p>
<p>データ表示ルール変更部は、(2)・(3)・(4)で実現している。
(4)で示すように、<code class="docutils literal"><span class="pre">Slick.Grid</span></code>コンストラクタの第2引数に、データの配列の代わりに<code class="docutils literal"><span class="pre">getLength</span></code>と<code class="docutils literal"><span class="pre">getItem</span></code>関数を持つオブジェクトを指定している。こうすることで、テーブルの各行には<code class="docutils literal"><span class="pre">getItem</span></code>関数の返すデータが表示されるようになる。</p>
<p><code class="docutils literal"><span class="pre">getItem</span></code>関数は(3)で定義している。引数<code class="docutils literal"><span class="pre">index</span></code>は表示行のインデックス番号を受け取るので、これを用いて、
あらかじめ(2)で作成しておいたインデックスからソート設定に基づいてデータを引き当てている。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>この例では、ソートのためのインデックス作成とデータ引き当てについて複雑な実装を行っている。
これはパフォーマンスを考慮したためである。</p>
<p>最もシンプルな実装は、<code class="docutils literal"><span class="pre">onSort</span></code>イベントハンドラ内で、 クリックされたカラムの値をもとに<code class="docutils literal"><span class="pre">data</span></code>配列を
逆順ソートすることである。この実装の場合、データ長が数千件ならよいが、数万件以上に及んだ場合には
ソートを実行する度に大きなオーバーヘッドが発生する。</p>
<p class="last">SlickGridの主要な用途の一つに大量データ表示が挙げられるため、ここでは大量データ表示に耐えうる
ソートの実装を例示した。</p>
</div>
</div>
<div class="section" id="id49">
<h4>4.6.2.2. tablesorterによるソート<a class="headerlink" href="#id49" title="Permalink to this headline">¶</a></h4>
<p>tablesorterは標準でデータのソートが可能なため、特別な考慮は不要である。よって <a class="reference internal" href="#basic-usages-tablesorter"><span class="std std-ref">tablesorter基本構成サンプル</span></a> を参照すること。</p>
<p>なお、tablesorterは、デフォルトの設定で数値か文字かを自動的に判別しソートできる。
また、複合キーによるソートが可能であり、Shiftキーを押した状態でのソートの操作、またはJavaScriptの実装により、実現できる。
詳細は<a class="reference external" href="https://mottie.github.io/tablesorter/docs/example-trigger-sort.html">tablesorterの公式ウェブサイトのリファレンス</a>を参照すること。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">標準で提供されているソート機能を無効化したい場合は、無効化したいカラムの<code class="docutils literal"><span class="pre">th</span></code>要素に対して、<code class="docutils literal"><span class="pre">data-sorter=false</span></code>の属性を設定する。</p>
</div>
</div>
</div>
</div>
<div class="section" id="swap-columns">
<span id="id50"></span><h2>4.7. カラムの並び替え<a class="headerlink" href="#swap-columns" title="Permalink to this headline">¶</a></h2>
<p>SlickGridは標準でカラムの並び替えができるため、特別な考慮は不要である。よって<a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>を参照すること。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">標準で提供されているカラムの並び替え機能を無効化するためには、動作オプション<code class="docutils literal"><span class="pre">enableColumnReorder</span></code>を<code class="docutils literal"><span class="pre">false</span></code>に設定する。</p>
</div>
</div>
<div class="section" id="copy-and-paste">
<span id="id51"></span><h2>4.8. コピーアンドペースト編集<a class="headerlink" href="#copy-and-paste" title="Permalink to this headline">¶</a></h2>
<div class="section" id="copy-and-paste-outline">
<span id="id52"></span><h3>4.8.1. 概要<a class="headerlink" href="#copy-and-paste-outline" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGridを用いて、テーブルのデータのコピーアンドペーストによる編集を行う方法を説明する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/copy-and-paste.html">SlickGridによるコピーアンドペースト編集サンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="copy-and-paste-howtouse">
<span id="id55"></span><h3>4.8.2. 利用方法<a class="headerlink" href="#copy-and-paste-howtouse" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>で示したHTMLに加え、次のモジュールを読み込む。それ以外は同様なので省略する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slick.cellcopymanager.js</td>
<td>コピーアンドペースト機能を提供する</td>
</tr>
<tr class="row-odd"><td>slick.cellrangeselector.js</td>
<td>セル選択機能を提供する</td>
</tr>
<tr class="row-even"><td>slick.cellrangedecorator.js</td>
<td>セル選択機能を提供する</td>
</tr>
<tr class="row-odd"><td>slick.cellselectionmodel.js</td>
<td>セル選択機能を提供する</td>
</tr>
</tbody>
</table>
<p>JavaScript(copy-and-paste.js)では、コピーアンドペースト操作によって発生するイベントを監視し、データのコピーとテーブルの再描画を行う。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright(c) 2018 NTT Corporation.</span>
<span class="cm"> */</span>
<span class="c1">// copy-and-paste.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="c1">// SlickGridのカラム定義</span>
  <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">30</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;title&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;duration&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;%&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;% Complete&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;percentComplete&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;start&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Finish&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;finish&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;effort-driven&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Effort Driven&#39;</span><span class="p">,</span> <span class="nx">field</span><span class="o">:</span> <span class="s1">&#39;effortDriven&#39;</span><span class="p">}</span>
  <span class="p">];</span>

  <span class="c1">// SlickGrid動作オプション</span>
  <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// 何も指定しない。</span>
  <span class="p">};</span>

  <span class="c1">// 1000件のサンプルデータ作成</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">id</span><span class="o">:</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;タスク &#39;</span> <span class="o">+</span> <span class="nx">i</span><span class="p">,</span>
      <span class="nx">duration</span><span class="o">:</span> <span class="s1">&#39;5 days&#39;</span><span class="p">,</span>
      <span class="nx">percentComplete</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">round</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
      <span class="nx">start</span><span class="o">:</span> <span class="s1">&#39;01/01/2009&#39;</span><span class="p">,</span>
      <span class="nx">finish</span><span class="o">:</span> <span class="s1">&#39;01/05/2009&#39;</span><span class="p">,</span>
      <span class="nx">effortDriven</span><span class="o">:</span> <span class="p">(</span><span class="nx">i</span> <span class="o">%</span> <span class="mi">5</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;true&#39;</span> <span class="o">:</span> <span class="s1">&#39;false&#39;</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// 画面初期化処理</span>
  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// SlickGridテーブルを作成</span>
    <span class="kd">var</span> <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

    <span class="c1">// (1) セル選択機能のプラグインを追加</span>
    <span class="kd">var</span> <span class="nx">cellSelectionModel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">CellSelectionModel</span><span class="p">();</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">setSelectionModel</span><span class="p">(</span><span class="nx">cellSelectionModel</span><span class="p">);</span>

    <span class="c1">// (2) コピーアンドペースト機能のプラグインを追加</span>
    <span class="kd">var</span> <span class="nx">copyManager</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">CellCopyManager</span><span class="p">();</span>
    <span class="nx">grid</span><span class="p">.</span><span class="nx">registerPlugin</span><span class="p">(</span><span class="nx">copyManager</span><span class="p">);</span>

    <span class="c1">// (3) ペーストイベントハンドラ</span>
    <span class="nx">copyManager</span><span class="p">.</span><span class="nx">onPasteCells</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">from</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">to</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">to</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">I</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">J</span><span class="p">;</span>

      <span class="c1">// コピー元のデータを保存するための配列</span>
      <span class="kd">var</span> <span class="nx">src</span> <span class="o">=</span> <span class="p">[];</span>

      <span class="c1">// コピー元のデータを保存</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">I</span> <span class="o">=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">toRow</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">fromRow</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">I</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">src</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">from</span><span class="p">.</span><span class="nx">toCell</span> <span class="o">-</span> <span class="nx">from</span><span class="p">.</span><span class="nx">fromCell</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">J</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">src</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">[</span><span class="nx">from</span><span class="p">.</span><span class="nx">fromRow</span> <span class="o">+</span> <span class="nx">i</span><span class="p">][</span><span class="nx">columns</span><span class="p">[</span><span class="nx">from</span><span class="p">.</span><span class="nx">fromCell</span> <span class="o">+</span> <span class="nx">j</span><span class="p">].</span><span class="nx">field</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">// ペースト先にコピーしたデータを上書き</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">I</span> <span class="o">=</span> <span class="nx">src</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">I</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">to</span><span class="p">.</span><span class="nx">toRow</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">J</span> <span class="o">=</span> <span class="nx">src</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">J</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">j</span> <span class="o">+</span> <span class="nx">to</span><span class="p">.</span><span class="nx">toCell</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">data</span><span class="p">[</span><span class="nx">to</span><span class="p">.</span><span class="nx">fromRow</span> <span class="o">+</span> <span class="nx">i</span><span class="p">][</span><span class="nx">columns</span><span class="p">[</span><span class="nx">to</span><span class="p">.</span><span class="nx">fromCell</span> <span class="o">+</span> <span class="nx">j</span><span class="p">].</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="nx">src</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">];</span>
          <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidateRow</span><span class="p">(</span><span class="nx">to</span><span class="p">.</span><span class="nx">fromRow</span> <span class="o">+</span> <span class="nx">i</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="c1">// ペースト先を選択状態にする。</span>
      <span class="nx">cellSelectionModel</span><span class="p">.</span><span class="nx">setSelectedRanges</span><span class="p">([{</span>
        <span class="nx">fromRow</span><span class="o">:</span> <span class="nx">to</span><span class="p">.</span><span class="nx">fromRow</span><span class="p">,</span>
        <span class="nx">fromCell</span><span class="o">:</span> <span class="nx">to</span><span class="p">.</span><span class="nx">fromCell</span><span class="p">,</span>
        <span class="nx">toRow</span><span class="o">:</span> <span class="nx">to</span><span class="p">.</span><span class="nx">fromRow</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="nx">toCell</span><span class="o">:</span> <span class="nx">to</span><span class="p">.</span><span class="nx">fromCell</span> <span class="o">+</span> <span class="nx">j</span> <span class="o">-</span> <span class="mi">1</span>
      <span class="p">}]);</span>

      <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>ソースコードリスト上の(1)で、セル選択機能を提供するプラグインを設定している。また(2)でコピーアンドペースト機能を提供するプラグインを設定している。これによってコピーアンドペースト操作によって<code class="docutils literal"><span class="pre">onPasteCells</span></code>イベントが発生するようになるため、これを(3)で監視し、データのコピー後、テーブルの表示を更新している。</p>
</div>
</div>
<div class="section" id="slickgrid-with-ajax">
<span id="id56"></span><h2>4.9. テーブルのスクロールによる非同期データ取得<a class="headerlink" href="#slickgrid-with-ajax" title="Permalink to this headline">¶</a></h2>
<div class="section" id="slickgrid-with-ajax-overview">
<span id="id57"></span><h3>4.9.1. 概要<a class="headerlink" href="#slickgrid-with-ajax-overview" title="Permalink to this headline">¶</a></h3>
<p>ここでは、SlickGridを用いて非同期通信でデータを取得し、テーブルに表示する方法を紹介する。</p>
<p>検索画面などで大量データをテーブルに表示する場合、全データを1度に表示するとクライアントやサーバに負荷が掛かる。そのため、初期表示に必要な分だけデータを取得し、以降はユーザー操作に合わせて非同期通信で取得するのが望ましい。</p>
<p>上記を実現するには、スクロール時に非同期通信でデータを取得し、SlickGridに関連付けられたデータ配列に追加してテーブルを再描画すればよい。概念的にはシンプルだが、非同期通信が頻発しないようある程度の件数をまとめて取得するなど、独自に作りこむ必要がある。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="40%" />
<col width="40%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">利用ライブラリ</th>
<th class="head">サンプル</th>
<th class="head">参考ページ</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SlickGrid</td>
<td><a class="reference external" href="../samples/slickgrid/slickgrid-with-ajax.html">SlickGridによる非同期データ取得サンプル</a></td>
<td><a class="reference external" href="https://github.com/6pac/SlickGrid/wiki">SlickGrid Wiki</a></td>
</tr>
</tbody>
</table>
<p>サンプルの動作イメージを示す。
下図は、初期表示時のテーブルを示している。</p>
<div class="figure align-center" id="id73">
<img alt="初期表示時の表示範囲と取得範囲" src="../_images/slickgrid-with-ajax-before-scroll.png" />
<p class="caption"><span class="caption-text"><strong>図: 初期表示時の表示範囲と取得範囲</strong></span></p>
</div>
<p>前提として、本例ではテーブルの領域を以下に分類する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">領域</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>表示範囲</td>
<td>テーブルのうち、画面に表示される範囲を示す。本例では20件とする。</td>
</tr>
<tr class="row-odd"><td>取得範囲</td>
<td>1度の非同期通信で取得する範囲を示す。本例では50件とする。</td>
</tr>
</tbody>
</table>
<p>初期表示時は、取得範囲のデータを非同期通信で取得し、表示範囲のデータを画面に表示する。</p>
<p>次に、スクロール後のイメージを示す。</p>
<div class="figure align-center" id="id74">
<img alt="スクロール後の表示範囲と取得範囲" src="../_images/slickgrid-with-ajax-after-scroll.png" />
<p class="caption"><span class="caption-text"><strong>図: スクロール後の表示範囲と取得範囲</strong></span></p>
</div>
<p>スクロールによって表示範囲が取得範囲からはみ出している。この時点で次の取得範囲分のデータを非同期通信で取得する。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>表示範囲の件数はテーブルの高さに依存する。高さを広げる場合、初期表示時にテーブルが空行にならないよう取得範囲を調整すること。</p>
<p class="last">また、取得範囲の件数が表示範囲に近いほど、非同期通信の頻度が高まる。システムの要件などを考慮し、取得範囲の件数を調整すること。</p>
</div>
</div>
<div class="section" id="slickgrid-with-ajax-howtouse">
<span id="id60"></span><h3>4.9.2. 利用方法<a class="headerlink" href="#slickgrid-with-ajax-howtouse" title="Permalink to this headline">¶</a></h3>
<p>SlickGridを利用した非同期データ取得の実装例を紹介する。</p>
<p><a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>に示したHTMLに加え、独自に実装した次のモジュールを読み込む。それ以外は同様なので省略する。</p>
<p>JavaScriptは以下を実装する。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">モジュール名</th>
<th class="head">用途</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>slickgrid-with-ajax.js</td>
<td>スクロールを監視し、非同期通信を行う関数を実行する。また、テーブルを描画する。</td>
</tr>
<tr class="row-odd"><td>slickgrid-remotemodel.js</td>
<td>非同期通信でデータを取得する。</td>
</tr>
</tbody>
</table>
<p>各JavaScriptの実装を説明する。</p>
<p>slickgrid-with-ajax.jsの実装を以下に示す。
なお、SlickGridのカラム定義、SlickGrid動作オプションは <a class="reference internal" href="#basic-usages-slickgrid"><span class="std std-ref">SlickGrid基本構成サンプル</span></a>のJavaScript(js/default.js)と同一であるため、省略する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// slickgrid-with-ajax.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// SlickGridのカラム定義</span>
    <span class="cm">/* omitted */</span>

    <span class="c1">// SlickGrid動作オプション</span>
    <span class="cm">/* omitted */</span>

    <span class="kd">var</span> <span class="nx">grid</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">loadingIndicator</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="c1">// テーブルデータを非同期で取得するオブジェクト生成</span>
    <span class="kd">var</span> <span class="nx">loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slickgrid</span><span class="p">.</span><span class="nx">Data</span><span class="p">.</span><span class="nx">RemoteModel</span><span class="p">();</span>

    <span class="c1">// 画面初期化処理</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

      <span class="c1">// SlickGridテーブルを作成</span>
      <span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Grid</span><span class="p">(</span><span class="s1">&#39;#myGrid&#39;</span><span class="p">,</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span> <span class="nx">columns</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

      <span class="c1">// スクロール時に起動するイベント</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">onViewportChanged</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="c1">// 開始位置・終了位置取得</span>
        <span class="kd">var</span> <span class="nx">vp</span> <span class="o">=</span> <span class="nx">grid</span><span class="p">.</span><span class="nx">getViewport</span><span class="p">();</span>

        <span class="c1">// データ取得関数実行</span>
        <span class="nx">loader</span><span class="p">.</span><span class="nx">ensureData</span><span class="p">(</span><span class="nx">vp</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span> <span class="nx">vp</span><span class="p">.</span><span class="nx">bottom</span><span class="p">);</span>
      <span class="p">});</span>

      <span class="c1">// ローディング中に起動するイベント</span>
      <span class="nx">loader</span><span class="p">.</span><span class="nx">onDataLoading</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

        <span class="c1">// データ取得中であることを示すメッセージ出力</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loadingIndicator</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">loadingIndicator</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;span&gt;&lt;label&gt;Buffering...&lt;/label&gt;&lt;/span&gt;&#39;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>

          <span class="c1">// CSSの設定</span>
          <span class="cm">/* omitted */</span>
        <span class="p">}</span>
        <span class="nx">loadingIndicator</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
      <span class="p">});</span>

      <span class="c1">// ローディング後に起動するイベント</span>
      <span class="nx">loader</span><span class="p">.</span><span class="nx">onDataLoaded</span><span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// 表示する行のみ有効化</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">from</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">to</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">grid</span><span class="p">.</span><span class="nx">invalidateRow</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
        <span class="nx">loadingIndicator</span><span class="p">.</span><span class="nx">fadeOut</span><span class="p">();</span>
      <span class="p">});</span>

      <span class="c1">// テーブル表示</span>
      <span class="nx">grid</span><span class="p">.</span><span class="nx">onViewportChanged</span><span class="p">.</span><span class="nx">notify</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="p">}());</span>
</pre></div>
</div>
<p>slickgrid-with-ajax.jsには3つのイベントを実装する。各イベントの機能は以下の通り。</p>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">イベント名</th>
<th class="head">説明</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>onViewportChanged</td>
<td>スクロール時に発生する。テーブルの表示領域を<code class="docutils literal"><span class="pre">grid.getViewport</span></code>で取得する。</td>
</tr>
<tr class="row-odd"><td>onDataLoading</td>
<td>非同期通信中に発生する。データ取得中であることを示すインディケータを表示する。</td>
</tr>
<tr class="row-even"><td>onDataLoaded</td>
<td>非同期通信後に発生する。<code class="docutils literal"><span class="pre">grid.invalidateRow</span></code>で再描画対象を設定し、<code class="docutils literal"><span class="pre">grid.render</span></code>でテーブルを再描画する。完了後にインディケータを非表示にする。</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>次に、slickgrid-remotemodel.jsを説明する。
なお、ソースが長いため、途中で区切って解説を加える。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// slickgrid-remotemodel.js</span>

<span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">function</span> <span class="nx">RemoteModel</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// 変数定義</span>
    <span class="kd">var</span> <span class="nx">PAGESIZE</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">length</span> <span class="o">:</span> <span class="mi">1000</span>
    <span class="p">};</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">PAGESIZE</span></code>は取得範囲の件数である。表示範囲の開始位置・終了位置を<code class="docutils literal"><span class="pre">PAGESIZE</span></code>で除算することで、取得範囲上の位置（以降、ポインタとする）を得られる。また、非同期通信で取得するデータの件数などにも使用する。</p>
<p><code class="docutils literal"><span class="pre">data</span></code>はテーブルデータを格納する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">hRequest</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">req</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="c1">// イベント</span>
<span class="kd">var</span> <span class="nx">onDataLoading</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Event</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">onDataLoaded</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Slick</span><span class="p">.</span><span class="nx">Event</span><span class="p">();</span>

<span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// データ取得関数</span>
<span class="kd">function</span> <span class="nx">ensureData</span><span class="p">(</span><span class="nx">from</span><span class="p">,</span> <span class="nx">to</span><span class="p">)</span> <span class="p">{</span>

  <span class="c1">// 非同期通信が実行中の場合、直前の処理を中断する</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">abort</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">fromPage</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">toPage</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// 処理中のデータを削除する</span>
      <span class="nx">data</span><span class="p">[</span><span class="nx">i</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 開始位置が0以下の場合は0に補正する</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">from</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">from</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// 終了位置が上限以上の場合は上限値に補正する</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">to</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">to</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 開始位置・終了位置からポインタを算出する</span>
  <span class="kd">var</span> <span class="nx">fromPage</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">from</span> <span class="o">/</span> <span class="nx">PAGESIZE</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">toPage</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">to</span> <span class="o">/</span> <span class="nx">PAGESIZE</span><span class="p">);</span>
</pre></div>
</div>
<p>パラメータの<code class="docutils literal"><span class="pre">from</span></code>・<code class="docutils literal"><span class="pre">to</span></code>には、テーブル表示の開始位置・終了位置が格納されいている。
<code class="docutils literal"><span class="pre">PAGESIZE</span></code>で除算することでポインタを取得する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// ポインタが異なる場合、位置を補正する</span>
<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">fromPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">data</span><span class="p">[</span><span class="nx">fromPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
  <span class="nx">fromPage</span> <span class="o">&lt;</span> <span class="nx">toPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">fromPage</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">toPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">data</span><span class="p">[</span><span class="nx">toPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
  <span class="nx">fromPage</span> <span class="o">&lt;</span> <span class="nx">toPage</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">toPage</span><span class="o">--</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>スクロールによって表示範囲が取得範囲を跨った場合、ポインタを前後に補正する。</p>
<p>例えばテーブルを下方向にスクロールし、表示範囲がテーブルデータの40件目から60件目にある場合、開始位置のポインタは「0」、終了位置のポインタは「1」となる。</p>
<p>上記の場合は<code class="docutils literal"><span class="pre">fromPage</span></code>を加算し、後続の判定でポインタ「1」（テーブルデータの50件目から100件目の範囲）にデータが存在するかチェックする。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// 取得範囲のデータが取得済みか判定する</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">fromPage</span> <span class="o">&gt;</span> <span class="nx">toPage</span> <span class="o">||</span>
  <span class="p">(</span><span class="nx">fromPage</span> <span class="o">===</span> <span class="nx">toPage</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="nx">fromPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">===</span> <span class="kc">null</span> <span class="o">||</span> <span class="nx">data</span><span class="p">[</span><span class="nx">fromPage</span> <span class="o">*</span>
    <span class="nx">PAGESIZE</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)))</span> <span class="p">{</span>

  <span class="c1">// テーブルを再描画するイベントを発生させる</span>
  <span class="nx">onDataLoaded</span><span class="p">.</span><span class="nx">notify</span><span class="p">({</span>
    <span class="nx">from</span> <span class="o">:</span> <span class="nx">from</span><span class="p">,</span>
    <span class="nx">to</span> <span class="o">:</span> <span class="nx">to</span>
  <span class="p">});</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>データの有無をチェックし、存在する場合はテーブルを再描画する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="c1">// 非同期通信のURLを編集する</span>
<span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s1">&#39;js/slickgrid-data.json&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>非同期通信に使用するURLを編集する。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>本例では<code class="docutils literal"><span class="pre">url</span></code>を固定としている。サーバからデータを取得する場合は、データを絞り込むために開始位置や取得件数などをパラメータとして設定する。以下に例を示す。</p>
<blockquote class="last">
<div><div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="s2">&quot;http://your.server.path/scroll?start=&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">fromPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&amp;limit=&quot;</span> <span class="o">+</span> <span class="nx">PAGESIZE</span><span class="p">);</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>  <span class="c1">// setTimeoutが実行中の場合、直前の処理を中断する</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">hRequest</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">hRequest</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// 非同期通信を実行する</span>
  <span class="nx">hRequest</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

    <span class="c1">// データ取得中であることを示すイベントを発生させる</span>
    <span class="nx">onDataLoading</span><span class="p">.</span><span class="nx">notify</span><span class="p">();</span>

    <span class="c1">// 非同期通信処理</span>
    <span class="nx">req</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span> <span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
      <span class="nx">url</span> <span class="o">:</span> <span class="nx">url</span><span class="p">,</span>
      <span class="nx">dataType</span> <span class="o">:</span> <span class="s1">&#39;json&#39;</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

      <span class="c1">// データ配列を編集する</span>
      <span class="nx">onSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">fromPage</span><span class="p">);</span>
    <span class="p">});</span>

    <span class="c1">// 中断時にデータを削除するために格納する</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">fromPage</span> <span class="o">=</span> <span class="nx">fromPage</span><span class="p">;</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">toPage</span> <span class="o">=</span> <span class="nx">toPage</span><span class="p">;</span>
  <span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>スクロールはマウスホイールによって連続的に実行される可能性があるため、<code class="docutils literal"><span class="pre">setTimeout</span></code>で一定時間待機後に非同期通信を実行する。</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span>    <span class="c1">// データ編集を行う関数</span>
    <span class="kd">function</span> <span class="nx">onSuccess</span><span class="p">(</span><span class="nx">resp</span><span class="p">,</span> <span class="nx">fromPage</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">from</span> <span class="o">=</span> <span class="nx">fromPage</span> <span class="o">*</span> <span class="nx">PAGESIZE</span><span class="p">,</span> <span class="nx">to</span> <span class="o">=</span> <span class="nx">from</span> <span class="o">+</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

      <span class="c1">// 取得したデータをdataに格納する</span>
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">results</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">item</span><span class="p">;</span>

        <span class="nx">data</span><span class="p">[</span><span class="nx">from</span> <span class="o">+</span> <span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
        <span class="nx">data</span><span class="p">[</span><span class="nx">from</span> <span class="o">+</span> <span class="nx">i</span><span class="p">].</span><span class="nx">index</span> <span class="o">=</span> <span class="nx">from</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
      <span class="p">}</span>

      <span class="nx">req</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

      <span class="c1">// テーブルを再描画するイベントを発生させる</span>
      <span class="nx">onDataLoaded</span><span class="p">.</span><span class="nx">notify</span><span class="p">({</span>
        <span class="nx">from</span> <span class="o">:</span> <span class="nx">from</span><span class="p">,</span>
        <span class="nx">to</span> <span class="o">:</span> <span class="nx">to</span>
      <span class="p">});</span>
    <span class="p">}</span>

    <span class="nx">init</span><span class="p">();</span>

    <span class="k">return</span> <span class="p">{</span>

      <span class="c1">// プロパティ</span>
      <span class="s1">&#39;data&#39;</span> <span class="o">:</span> <span class="nx">data</span><span class="p">,</span>

      <span class="c1">// 関数</span>
      <span class="s1">&#39;ensureData&#39;</span> <span class="o">:</span> <span class="nx">ensureData</span><span class="p">,</span>

      <span class="c1">// イベント</span>
      <span class="s1">&#39;onDataLoading&#39;</span> <span class="o">:</span> <span class="nx">onDataLoading</span><span class="p">,</span>
      <span class="s1">&#39;onDataLoaded&#39;</span> <span class="o">:</span> <span class="nx">onDataLoaded</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="c1">// Slick.Data.RemoteModel</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nb">window</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">Slick</span> <span class="o">:</span> <span class="p">{</span>
      <span class="nx">Data</span> <span class="o">:</span> <span class="p">{</span>
        <span class="nx">RemoteModel</span> <span class="o">:</span> <span class="nx">RemoteModel</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}());</span>
</pre></div>
</div>
<p>最後に取得したデータを<code class="docutils literal"><span class="pre">data</span></code>に格納し、テーブルを再描画する。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">本例ではテーブルの表示件数を1000件に固定している。必要に応じて<code class="docutils literal"><span class="pre">data.length</span></code>に任意の数値を設定すること。</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">本例ではデータの変動（追加・変更・削除）を考慮していない。取得したデータはクライアント側でキャッシュするため、サーバ側でデータが変動すると齟齬が生じる。非同期通信時にクライアント・サーバ間のデータをチェックするなど、変動を前提とした実装を考慮すること。</p>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../manipulation/index.html" title="5. 操作性向上・制御"
             >next</a></li>
        <li class="right" >
          <a href="../uicomponent/index.html" title="3. UIコンポーネント"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Macchinetta Client (1.x) Development Guideline 1.2.0.RELEASE documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2017 NTT Corporation.
    </div>
  </body>
</html>