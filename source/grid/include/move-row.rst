.. _move-row:

行の並び替え
================================================

.. _move-row-outline:

概要
------------------------------------------------

ここでは、SlickGridを用いて、行の並び替えを行う方法を説明する。

.. list-table::
   :header-rows: 1
   :widths: 20 40 40

   * - |using-library-name|
     - |sample|
     - |reference-page|
   * - SlickGrid
     - `SlickGridによる行の並び替えサンプル <../samples/slickgrid/move-row.html>`_
     - `SlickGrid Wiki <https://github.com/mleibman/SlickGrid/wiki>`_

.. _move-row-howtouse:

利用方法
------------------------------------------------

行の並び替えをするためには、SlickGridに関連付けられたデータ配列の中身を並び替えてテーブルを再描画すればよい。
概念的にはシンプルだが、複数行の一括並び替えなどを実現する場合は、並び替えの処理に複雑な実装が必要となる。

この例では、次のユーザインタフェースでの実現方法を説明する。

* 行ドラッグアンドドロップ操作による並び替えができる
* Ctrl または Shift クリックで複数行を選択して一括で並び替えができる

:ref:`basic-usages-slickgrid`\ で示したHTMLに加え、次のモジュールを読み込む。それ以外は同様なので省略する。

.. list-table::
   :header-rows: 1
   :widths: 20 80

   * - モジュール名
     - 用途
   * - slick.editors.js
     - 行のドラッグアンドドロップ操作ができるユーザインタフェースを提供する
   * - slick.rowselectionmodel.js
     - 行選択機能を提供する

JavaScript(move-row.js)では、ユーザインタフェースの操作によって発生するイベントを監視し、行データの並び替えとテーブルの再描画を行う。

.. literalinclude:: /_samples/samples/slickgrid/js/move-row.js
   :language: javascript

行のドラッグアンドドロップ操作は、ソースコードリスト上の(1)・(3)・(4)で実現している。
(3)でドラッグアンドドロップ操作を実現するプラグインをテーブルにセットした上で、(1)のカラム定義で
\ ``behavior``\ プロパティに\ ``'selectAndMove'``\ を設定する。
これによりドロップアンドドロップ操作が可能となり、また操作後には\ ``onMoveRows``\ イベントが発生するようになる。
このイベントを(4)で監視し、コールバック関数内でデータの並び替えと再描画を行っている。

複数行の一括並び替え機能は、(2)・(4)で実現している。
(2)では行選択機能を提供するプラグインをテーブルにセットしている。
(4)ではデータ配列を並び替えてテーブルを再描画している。
並び替えの処理は、複数行の一括の並び替えなど、様々な操作条件に対応するため複雑な実装になっているが、
SlickGridの使用方法の説明という目的から外れるため、この部分の説明は割愛する。

.. note::
   このサンプルでは、複数行を選択して一括で並び替えを行う操作(1行目と4行目を選択し、2行目に移動するなど)を実現しているが、並び替えのロジックはライブラリから提供されていない。ライブラリが提供しているのは、「複数行の選択状態を管理する機能」と「ドラッグアンドドロップ操作によりイベントを発生させる機能」であり、これらの機能と独自実装した並び替えのロジックを組み合せて実現している。

   この他にも、SlickGridはロジックの独自実装に活用できるインタフェースや独自イベントを提供していることから、フレームワークとしての性質が強い。
